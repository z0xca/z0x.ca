---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";

export async function getStaticPaths() {
	const posts = await getCollection("writing");
	return posts.map((post) => ({
		params: { slug: post.slug },
		props: { post },
	}));
}

const { post } = Astro.props;
const { Content } = await post.render();

// Get all posts for navigation, sorted by date (oldest first)
const allPosts = (await getCollection("writing")).sort(
	(a, b) => new Date(a.data.date).getTime() - new Date(b.data.date).getTime(),
);
const currentIndex = allPosts.findIndex((p) => p.slug === post.slug);
const prevPost = currentIndex > 0 ? allPosts[currentIndex - 1] : null;
const nextPost =
	currentIndex < allPosts.length - 1 ? allPosts[currentIndex + 1] : null;
---

<Layout>
  <article>
    <header class="mb-16 pb-6 border-b border-border">
      <h1 class="text-3xl font-bold mb-4 leading-tight">{post.data.title}</h1>
      <p class="text-lg text-muted-foreground leading-relaxed">{post.data.description}</p>
    </header>
    
    <div class="prose max-w-none">
      <Content />
    </div>
  </article>
  
  <nav class="mt-32 border-t border-border pt-6 flex flex-col gap-4 sm:flex-row sm:justify-between sm:items-start">
    <a 
      class={`flex flex-col items-end text-sm no-underline order-2 sm:order-1 sm:items-start ${!prevPost ? 'pointer-events-none opacity-50 cursor-not-allowed' : ''}`}
      href={prevPost ? `/writing/${prevPost.slug}` : '#'}
      aria-disabled={!prevPost}
    >
      <span class="text-muted-foreground">Previous</span>
      <span class="inline-block min-w-0 max-w-full truncate">
        {prevPost?.data.title || 'Oldest post!'}
      </span>
    </a>

    <a 
      class={`flex flex-col items-start text-sm no-underline order-1 sm:order-2 sm:items-end ${!nextPost ? 'pointer-events-none opacity-50 cursor-not-allowed' : ''}`}
      href={nextPost ? `/writing/${nextPost.slug}` : '#'}
      aria-disabled={!nextPost}
    >
      <span class="text-muted-foreground">Next</span>
      <span class="inline-block min-w-0 max-w-full truncate">
        {nextPost?.data.title || 'Latest post!'}
      </span>
    </a>
  </nav>
</Layout>
